
const {getClientIp} = require("../core/util")
const map = new Map();
const {equals} = require('ramda')


const setPreContext = (req, token) => {
    const ip = getClientIp(req);
    console.log(`=========SET TOKEN==IP:${ip}==TOKEN:${token}==============`)
    map.set(ip, token)
}

const checkPreContext = (req, token) => {
    if (!token) return false
    const ip = getClientIp(req);
    const mapToken = map.get(ip);
    console.log('IP:' + ip + ', OLD-TOKEN:' + mapToken+' ,NEW_TOKEN:' + token)
    return equals(token, mapToken)
}

module.exports = {
    setPreContext,
    checkPreContext
}


